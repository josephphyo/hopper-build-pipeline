version: 2.1

executors:
  docker-executor:
    docker:
    - image: circleci/python:3.8 # Use an image that has Docker installed

jobs:
  build-and-push:
    executor: docker-executor
    steps:
    - checkout # Checkout your source code

    - setup_remote_docker: # Set up Docker
        version: 20.10.7
        docker_layer_caching: true

    - run:
        name: Build and push Docker image to DockerHub
        command: |
          # Set environment variables
          export IMAGE_NAME=hopperbuild-circleci-image
          export DOCKER_REPO=phyominhtun/hopper-circleci-argocd
          export TAG=cptmarvel  # You can use a different tag if desired

          # Build the Docker image
          docker build -t $IMAGE_NAME:$TAG .

          # Authenticate with your Docker registry (e.g., Docker Hub)
          echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin

          # Tag the image with the repository and tag
          docker tag $IMAGE_NAME:$TAG $DOCKER_REPO/$IMAGE_NAME:$TAG

          # Push the Docker image to the registry
          docker push $DOCKER_REPO/$IMAGE_NAME:$TAG
